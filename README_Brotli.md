# افزودن پشتیبانی از فشرده‌سازی Brotli

## مشکل

برخی از وب‌سایت‌ها از روش فشرده‌سازی Brotli (با هدر `content-encoding: br`) برای کاهش حجم داده‌های منتقل شده استفاده می‌کنند. این روش نسبت به فشرده‌سازی‌های متداول قبلی مانند gzip کارآمدتر است، اما نیاز به کتابخانه خاصی برای رمزگشایی دارد.

زمانی که ربات سعی می‌کند محتوای یک وب‌سایت با فشرده‌سازی Brotli را استخراج کند و کتابخانه Brotli نصب نشده باشد، با خطای زیر مواجه می‌شود:

```
Error extracting HTML content: 400, message='Can not decode content-encoding: brotli (br). Please install `Brotli`'
```

## راه حل

برای حل این مشکل، کتابخانه Brotli را به پروژه اضافه کرده‌ایم:

1. کتابخانه Brotli به فایل `requirements.txt` اضافه شده است.
2. کد `web_extractor.py` به‌روزرسانی شده تا:
   - بررسی کند آیا کتابخانه Brotli نصب شده است یا خیر
   - پیام خطای مناسب نمایش دهد اگر کتابخانه موجود نیست
   - در سناریوهایی که سایت از Brotli استفاده می‌کند اما کتابخانه نصب نیست، پیام خطای دوستانه به کاربر نمایش دهد

## نحوه اعمال تغییرات

### در محیط توسعه محلی

برای نصب کتابخانه Brotli در محیط توسعه محلی، دستور زیر را اجرا کنید:

```bash
pip install brotli
```

### در محیط Heroku

برای اعمال این تغییرات در محیط Heroku، مراحل زیر را انجام دهید:

1. مطمئن شوید که تغییرات به مخزن گیت اضافه شده‌اند:
   ```bash
   git add requirements.txt web_extractor.py
   git commit -m "Add Brotli support for websites using brotli compression"
   ```

2. تغییرات را به Heroku ارسال کنید:
   ```bash
   git push heroku main
   ```

3. برنامه Heroku به طور خودکار بازسازی خواهد شد و کتابخانه Brotli را نصب خواهد کرد.

## تست

پس از اعمال تغییرات، می‌توانید با درخواست اطلاعات درباره یک وب‌سایت که از فشرده‌سازی Brotli استفاده می‌کند (مانند hpkv.io)، عملکرد آن را بررسی کنید:

```
درباره وب‌سایت hpkv.io اطلاعاتی بده
```

اکنون ربات باید بتواند محتوای وب‌سایت را استخراج کند و اطلاعات مفیدی را نمایش دهد. 